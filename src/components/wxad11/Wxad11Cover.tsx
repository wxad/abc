"use client"

import { useIntersectionObserver } from "react-intersection-observer-hook"
import confetti from "canvas-confetti"
import { useEffect, useRef } from "react"

const Cover = () => {
  const canvasRef = useRef<any>(null)
  const leftRef = useRef<HTMLDivElement | null>(null)
  const rightRef = useRef<HTMLDivElement | null>(null)
  const [ref, { entry }] = useIntersectionObserver({
    threshold: 0.5,
  })
  const inView = entry?.isIntersecting

  const handleConfetti = () => {
    const commmonProps = {
      // ticks: 50,
      particleCount: 30,
      startVelocity: Math.random() * 15 + 25,
      spread: Math.random() * 30 + 10,
      gravity: Math.random() + 0.2,
      colors: [
        "#00F58A",
        "#fff16f",
        "#00F58A",
        "#ff9a78",
        "#8486ff",
        "#07c160",
      ],
    }

    setTimeout(() => {
      if (canvasRef.current) {
        canvasRef.current.confetti({
          origin: { x: 0.75, y: 0.35 },
          angle: 78,
          drift: -Math.random(),
          ...commmonProps,
        })
        canvasRef.current.confetti({
          origin: { x: 0.27, y: 0.45 },
          angle: 108,
          drift: Math.random(),
          ...commmonProps,
        })
      }
    }, 100)
    ;[leftRef.current, rightRef.current].forEach((ref) => {
      if (ref) {
        ref.style.animation = "none"
        setTimeout(() => {
          ref.style.animation = "wxad11Stick 0.2s ease both"
        }, 50)
      }
    })
  }

  useEffect(() => {
    if (canvasRef.current) {
      canvasRef.current.confetti =
        canvasRef.current.confetti ||
        confetti.create(canvasRef.current, { resize: true })
    }
  }, [canvasRef.current])

  useEffect(() => {
    const timer = setTimeout(() => {
      handleConfetti()
    }, 1000)
    let interval = 0
    if (inView) {
      interval = window.setInterval(() => {
        handleConfetti()
      }, 4000)
    }

    return () => {
      clearTimeout(timer)
      clearInterval(interval)
    }
  }, [inView])

  return (
    <div
      className="relative rounded-full border border-neutral-300 overflow-hidden"
      ref={ref}
    >
      <div className="pt-[100%]" />
      <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 size-[300px] flex items-center justify-center">
        <div className="absolute top-[119px] left-[63px] w-[11px] h-[80px] -rotate-18">
          <div
            ref={leftRef}
            className="absolute top-0 left-0 w-full h-full bg-[#00F58A] origin-bottom"
          />
        </div>
        <div className="absolute top-[102px] left-[229px] w-[11px] h-[90px] rotate-12">
          <div
            ref={rightRef}
            className="absolute top-0 left-0 w-full h-full bg-[#00F58A] origin-bottom"
          />
        </div>
        <svg
          width="200"
          height="98"
          viewBox="0 0 200 98"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M78.521 78.4701C80.2727 78.4701 81.8456 79.3521 82.6748 80.7747L81.2931 81.5753C80.785 80.6242 79.7362 80.0186 78.521 80.0185C77.4886 80.0185 76.6595 80.3479 76.0092 80.9982C75.3751 81.6485 75.0578 82.4737 75.0578 83.4818C75.0578 84.4897 75.3751 85.315 76.0092 85.9653C76.6554 86.6155 77.4846 86.9445 78.521 86.9445C79.7362 86.9445 80.7972 86.3389 81.2931 85.3878L82.6748 86.1725C82.2765 86.8756 81.6951 87.4407 80.9513 87.8674C80.2198 88.2819 79.4069 88.4894 78.5249 88.4894C77.078 88.4894 75.8628 88.0055 74.9117 87.0545L74.9077 87.0505C73.9566 86.0873 73.4728 84.8962 73.4728 83.4778C73.4728 82.0592 73.9566 80.8721 74.9077 79.9169C75.8588 78.9538 77.0741 78.4701 78.521 78.4701ZM69.0911 81.23C70.0991 81.23 70.9244 81.5878 71.5747 82.291C72.2209 82.9941 72.5543 83.8638 72.5543 84.8718C72.5543 85.0221 72.5418 85.2294 72.5011 85.4894H67.0061C67.2255 86.538 68.0668 87.1196 69.213 87.1196C69.9974 87.1196 70.5908 86.8308 70.9932 86.2658L72.2209 86.9815C71.5462 87.9894 70.5382 88.485 69.2011 88.485C68.0833 88.485 67.1727 88.1396 66.4817 87.4649C65.7908 86.774 65.4493 85.9081 65.4493 84.8595C65.4493 83.8109 65.7948 82.9696 66.4694 82.2787C67.1441 81.5755 68.0262 81.23 69.0911 81.23ZM94.8724 81.226C95.9211 81.226 96.722 81.612 97.2869 82.3842V81.409H98.7786V88.3064H97.2869V87.3145C96.722 88.0989 95.9211 88.485 94.8724 88.485C93.9214 88.485 93.1207 88.1395 92.446 87.4363C91.7714 86.7332 91.4382 85.8635 91.4382 84.8555C91.4382 83.8476 91.7673 82.9778 92.446 82.2747C93.1247 81.5716 93.9214 81.2261 94.8724 81.226ZM125.027 88.3064H123.536V87.3145C122.971 88.0989 122.17 88.485 121.121 88.485C120.17 88.485 119.37 88.1395 118.695 87.4363C118.02 86.7332 117.687 85.8635 117.687 84.8555C117.687 83.8476 118.016 82.9778 118.695 82.2747C119.37 81.5716 120.17 81.226 121.121 81.226C122.17 81.226 122.971 81.612 123.536 82.3842V78.6491H125.027V88.3064ZM129.068 81.226C130.214 81.2261 131.136 81.7624 131.62 82.6605L130.364 83.3639C130.128 82.8396 129.69 82.5752 129.068 82.5752C128.503 82.5752 128.06 82.8234 128.06 83.3071C128.06 83.7622 128.637 83.9981 129.356 84.2053V84.2093C130.417 84.4451 131.799 84.8841 131.77 86.3595C131.77 87.0219 131.506 87.5464 130.998 87.9162C130.486 88.2902 129.852 88.4811 129.08 88.4811C127.714 88.481 126.706 87.8755 126.267 86.8675L127.548 86.1237C127.783 86.7862 128.291 87.1152 129.08 87.1152C129.868 87.1152 130.25 86.8553 130.25 86.3432C130.25 85.9002 129.673 85.6401 128.942 85.4612C127.909 85.2011 126.515 84.7863 126.539 83.3353C126.539 82.7013 126.775 82.1892 127.259 81.8031C127.743 81.417 128.348 81.226 129.068 81.226ZM102.652 81.4007H104.363V82.8355L104.359 82.8395H102.648V86.1479C102.648 87.0299 103.225 87.018 104.359 86.9652V88.3024C102.083 88.5788 101.161 87.9566 101.161 86.1479V82.8395H99.8924V81.4046H101.161V79.913L102.652 79.47V81.4007ZM55.9913 86.1967L58.1859 78.6491H59.6494L61.8277 86.1967L63.856 78.6491H65.5267L62.7951 88.3064H60.962L58.9218 81.2586L56.8649 88.3064H55.0236L52.2923 78.6491H53.963L55.9913 86.1967ZM85.443 82.291C85.8982 81.5878 86.6013 81.23 87.5808 81.23C89.166 81.23 90.2307 82.3072 90.2307 84.0712H90.2268V88.3064H88.7391V84.2216C88.7391 83.1892 88.1457 82.62 87.1946 82.62C86.146 82.62 85.443 83.2703 85.443 84.6074V88.3064H83.9513V78.6491H85.443V82.291ZM117.325 88.3064H115.61L114.935 86.3595H110.826L110.151 88.3064H108.428L111.932 78.6491H113.834L117.325 88.3064ZM138.188 88.3064H136.603V80.348H135.624V78.6773L136.811 78.6531V78.6491H138.188V88.3064ZM143.322 88.3064H141.737V80.348H140.757V78.6531H141.944V78.6491H143.322V88.3064ZM95.1082 82.6486C94.4864 82.6486 93.962 82.8557 93.5475 83.2825C93.1329 83.6971 92.9255 84.2215 92.9255 84.8555C92.9255 85.4896 93.1329 86.0141 93.5475 86.4408C93.962 86.8554 94.4864 87.0624 95.1082 87.0624C95.7301 87.0624 96.2547 86.8554 96.6693 86.4408C97.0839 86.0141 97.2909 85.4896 97.2909 84.8555C97.2909 84.2215 97.0838 83.6971 96.6693 83.2825C96.2547 82.8557 95.7301 82.6486 95.1082 82.6486ZM121.357 82.6486C120.739 82.6486 120.211 82.8557 119.796 83.2825C119.382 83.6971 119.174 84.2215 119.174 84.8555C119.174 85.4896 119.382 86.0141 119.796 86.4408C120.211 86.8554 120.735 87.0624 121.357 87.0624C121.979 87.0624 122.503 86.8554 122.914 86.4408C123.328 86.0141 123.536 85.4896 123.536 84.8555C123.536 84.2215 123.328 83.6971 122.914 83.2825C122.499 82.8558 121.975 82.6486 121.357 82.6486ZM111.342 84.8718H114.407L112.874 80.5103L111.342 84.8718ZM69.0749 82.5795C67.9734 82.5796 67.1971 83.2298 66.9898 84.2784H71.0464C70.8391 83.1606 70.0544 82.5795 69.0749 82.5795ZM146.683 78.6857V80.0471H147.529V80.7544L147.525 80.7505H146.679V82.3842C146.679 82.8191 146.964 82.8152 147.525 82.7867V83.4452C146.403 83.5793 145.948 83.2743 145.948 82.3842V80.7505H145.322V80.0432H145.948V78.6491L146.683 78.6857ZM148.927 80.4822C149.15 80.1326 149.5 79.9579 149.98 79.9578C150.764 79.9578 151.284 80.4903 151.284 81.3602L151.289 81.3558V83.4452H150.553V81.4332C150.553 80.9211 150.26 80.6445 149.793 80.6445C149.276 80.6446 148.927 80.9658 148.927 81.6241V83.4492H148.191V78.6857H148.927V80.4822ZM108.567 64.7686C108.567 67.2886 107.746 68.0119 104.978 68.0119H102.185L101.738 65.8943H104.331L104.327 65.8903C105.847 65.8903 106.071 65.5894 106.071 64.3701V48.8843H91.979V56.0175C91.979 62.4517 91.5319 64.6222 89.337 68.3616L86.8943 67.1136C89.0891 63.6222 89.4875 61.7526 89.4875 55.0665V46.6123H108.567V64.7686ZM119.825 45.7871L119 47.4819V47.4859H133.612V49.9044H125.605V53.4974H132.962V55.8917H125.605V60.1309H134.531V62.5736H125.605V67.8086H123.114V62.5736H111.891V60.1309H115.31V53.4974H123.114V49.9044H117.553C116.359 51.7497 114.911 53.4974 113.241 55.2411L111.595 53.0465C114.062 50.75 116.009 47.9088 117.232 45.0392L119.825 45.7871ZM70.3924 66.6425H67.5226V52.2538H65.7507V49.234L67.8965 49.1891L67.9009 49.1852H70.3924V66.6425ZM79.6718 66.6425H76.802V52.2538H75.0301V49.1891H77.1759L77.1803 49.1852H79.6718V66.6425ZM103.929 65.4676H93.9057V58.7083H103.929V65.4676ZM96.2956 63.2483H101.584V60.9275H96.2956V63.2483ZM117.85 60.1309H123.114V55.8917H117.85V60.1309ZM100.137 51.0749H104.453V53.1195H100.137V55.0911H105.323V57.1598H92.5565V55.0911H97.7182V53.1195H93.4016V51.0749H97.7182V49.2296H100.137V51.0749ZM62.3807 20.5627H63.5024V16.7986H65.547V22.3592C66.62 20.0424 67.4939 17.1726 67.815 15.0021L70.0342 15.2502C69.8107 16.5224 69.5097 17.7419 69.1602 18.9166H74.0214V21.2089H73.0255C72.6759 25.249 72.03 28.1918 70.7578 30.7605C71.8065 32.5326 73.103 34.0771 74.6231 35.5241L72.8794 37.5198C71.4812 35.9997 70.3349 34.5771 69.4122 33.0814C68.388 34.5771 67.067 36.024 65.4453 37.6457L63.7016 35.9508C65.6485 34.2803 67.0913 32.6098 68.1643 30.7645C67.4408 29.1428 66.9166 27.3707 66.5671 25.2532L66.2662 25.8017L64.921 23.6067L65.3965 22.66H57.1658V22.0623C56.7187 23.0093 56.1701 24.0337 55.5686 25.0539V35.9508C57.3406 34.2072 57.6902 33.2317 57.6902 30.7117V27.9682H64.372V32.0327L65.8435 30.911L66.4654 32.8535C65.868 33.3006 64.2706 34.5973 63.1975 35.6459L61.7019 34.1261C62.1733 33.7034 62.1735 33.2765 62.1735 33.0286V30.1588H59.9054V31.1547C59.9054 33.5975 59.4826 34.9673 57.5358 37.215L55.5642 36.0687V37.1662H53.3208V28.377C52.7991 29.072 52.2777 29.7188 51.76 30.289L50.7114 27.8705C52.2315 26.1512 54.0766 23.3303 55.174 20.912L57.1698 22.0095V16.7986H59.2144V20.5627H60.3361V14.9005H62.3807V20.5627ZM115.915 17.6766H123.645V20.1197H106.416V23.9564C106.416 30.3418 105.843 33.0855 103.124 37.4996L100.681 36.2028C103.351 32.1139 103.823 29.7444 103.823 24.2084V17.6766H113.025L111.627 15.1081L114.195 14.4861L115.915 17.6766ZM146.025 37.2964H143.33V36.4469H131.486V37.2964H128.844V27.9439H146.025V37.2964ZM83.0896 15.555C82.5409 17.4247 81.9678 19.1197 81.2931 20.7171V37.2515H78.8012V25.4766C78.3013 26.2488 77.8057 26.9968 77.2286 27.7486L75.5821 25.5052C77.529 22.9121 79.6223 18.5466 80.5937 14.856L83.0896 15.555ZM97.2544 37.1947H94.6855V36.0972H86.3575V37.1947H83.7886V28.716H97.2544V37.1947ZM131.486 33.9554H143.33V30.4394H131.486V33.9554ZM86.3575 33.8292H94.6855V30.988H86.3575V33.8292ZM68.4163 21.2128C68.3432 21.4607 68.2416 21.7127 68.1441 21.9606C68.3432 24.2774 68.7903 26.2734 69.465 28.0456C70.2129 26.0499 70.6602 23.8304 70.9122 21.2128H68.4163ZM96.9293 27.2445H84.0851V25.0253H96.9293V27.2445ZM65.2258 26.4237H56.6982V24.2287H65.2258V26.4237ZM139.119 18.0668H147.074V20.5099H139.119L139.115 20.5138V23.5051H148.594V25.9482H126.324V23.5051H136.473V20.5138H131.088C130.49 21.5869 129.815 22.6314 129.194 23.4809L126.926 22.0825C128.645 19.7861 129.819 17.6929 130.64 15.3518L133.059 16.173C132.86 16.7704 132.612 17.4206 132.311 18.0668H136.477V14.9739H139.119V18.0668ZM96.9293 23.5539H84.0851V21.3593H96.9293V23.5539ZM57.4464 16.2989C56.3246 18.2945 54.4303 20.9119 52.7313 22.8101V22.8061L50.9876 21.16C52.585 19.4163 54.4304 16.9206 55.4019 15.0509L57.4464 16.2989ZM91.0964 14.6282C91.446 15.25 92.0924 16.4979 92.6167 17.4734H98.9251V19.8676H82.7157V17.4694H89.6738C89.2755 16.6972 88.8002 15.8721 88.5279 15.4006L91.0964 14.6282Z"
            fill="black"
          />
        </svg>
      </div>
      <canvas ref={canvasRef} className="absolute top-0 left-0 w-full h-full" />
    </div>
  )
}

export default Cover
